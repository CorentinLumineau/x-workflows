# Parallelization Analysis

## Phase 2.5: File Overlap Analysis

After the user selects which quick wins to implement (Phase 2), analyze file overlap to determine which quick wins can safely run in parallel.

### Algorithm

1. **Extract primary file** from each selected quick win's `{file:line}` data (from x-quickwins report).

2. **Build conflict graph**: Create edges between quick wins that share the same primary file.
   - Node = quick win (by index)
   - Edge = shared primary file

3. **Partition into independent groups** using connected components:
   - Quick wins with no shared files → same parallel group
   - Quick wins sharing files → must be in the same sequential group

4. **Sort groups** by total score (highest-scoring group first).

### Limitation Caveat

> **Primary file only**: This analysis uses only the primary file listed in the x-quickwins report (`{file:line}`). Quick wins that modify secondary files (imports, test counterparts, shared utilities) may still conflict if their secondary files overlap. When quick win categories suggest broad changes (e.g., `solid` class decomposition, `dry` cross-module deduplication), treat the grouping as advisory and recommend conservative sequential execution for those items.

### Display Format

Present the parallelization plan to the user:

```
Parallelization analysis:
  Group A (parallel, 3 items): #1 constants.js, #2 auth.js, #9 types.ts — no file overlap
  Group B (parallel, 2 items): #3 UserService.js, #6 PaymentController.js — no file overlap
  Group C (sequential after B, 1 item): #5 UserService.js — shares file with #3

  Execution: 2 parallel rounds + 1 sequential
  Estimated speedup: ~2x vs fully sequential
```

### Edge Cases

| Scenario | Behavior |
|----------|----------|
| All quickwins touch different files | Single parallel group (best case) |
| All quickwins share one file | Single sequential group (worst case — no speedup) |
| Only 1 quickwin selected | Skip analysis, execute directly |
| Only 2 quickwins selected | Skip analysis if different files; sequential if same file |

### Integration with Execution Mode

The parallelization analysis **informs** the execution mode gate (Phase 3.5):
- If all quickwins are in one parallel group → recommend worktree mode (maximum benefit)
- If most quickwins must be sequential → suggest direct mode (worktree overhead not worth it)
- Always present both options — user decides

### Input Sanitization

Quick win data from x-quickwins output is **internal** (generated by the scan), not forge-sourced. However, file paths may contain special characters. Validate file paths against `/^[a-zA-Z0-9._/\-\s@]+$/` before display or shell use.
